---
title: 函数式编程概览
---

当前系列文章主要面向以命令式编程为主的攻城狮们，并假设您已经熟悉Javascript语言。因为我将以命令式编程为起点，基于Javascript为编程语言，以及Ramdajs|Fantasy-Land|Ramda-fantasy|Fluture这几个开源代码库，对函数式编程进行逐步讲解。

首先，我们看一下函数式编程的基本理念，纯函数和Pointfree编程。

## 函数式编程的基本理念

### 纯函数

纯函数是这样一种函数，即相同的输入，永远会得到相同的输出，而且没有任何副作用。

纯函数最显著的特点，是既不依赖外部的变量，也不修改外部的变量，而是单纯的依赖于输入，返回新的数据。

> 举例

要避免的副作用是什么？副作用是在函数执行过程中，引发的外部系统状态的任何变化，或者与外部系统进行的某种交互（因为有了交互就难免被影响）。简单的说，在真正的纯函数中，我们只能做数值的转换和计算，不能做任何外部IO操作，包括读写文件、读写数据库、访问HTTP接口等等。

> 举例

从本质上来说，所有软件产品，都有由IO和数据计算两类操作构成的。我们最经常犯的错误就是，把单纯的IO操作和单纯的数据计算两者混合在同一个函数中，或者在一个函数的数据计算中依赖了外部的变量，从而产生了许多本来不该有的不纯函数。

> 举例

很显然，我们无法仅仅使用纯函数来构造一个软件产品，我们只能尽可能减少不纯的函数数量和影响，具体的实施技巧我们将在后续讨论。


### Pointfree编程

Pointfree编程，即无参数风格编程。


函数式编程，顾名思义，就是一切都是函数，不再使用表达式语句。

1. 将外部数据变成常量，最终变为返回固定值（常量）的纯函数。（不依赖外部变量，变量常量化）
2. 不改变对象，而是返回新对象

在函数式语言中，函数作为一等公民，可以在任何地方定义，在函数内或函数外，可以作为函数的参数和返回值，可以对函数进行组合。纯函数式编程语言中的变量也不是命令式编程语言中的变量，即存储状态的单元，而是代数中的变量，即一个值的名称。变量的值是不可变的（immutable），也就是说不允许像命令式编程语言中那样多次给一个变量赋值。比如说在命令式编程语言我们写“x = x + 1”，这依赖可变状态的事实，拿给程序员看说是对的，但拿给数学家看，却被认为这个等式为假。函数式语言的如条件语句，循环语句也不是命令式编程语言中的控制语句，而是函数的语法糖，比如在Scala语言中，if else不是语句而是三元运算符，是有返回值的。严格意义上的函数式编程意味着不使用可变的变量，赋值，循环和其他命令式控制结构进行编程。

函数式编程的好处由于命令式编程语言也可以通过类似函数指针的方式来实现高阶函数，函数式的最主要的好处主要是不可变性带来的。没有可变的状态，函数就是引用透明（Referential transparency）的和没有副作用（No Side Effect）。一个好处是，函数即不依赖外部的状态也不修改外部的状态，函数调用的结果不依赖调用的时间和位置，这样写的代码容易进行推理，不容易出错。这使得单元测试和调试都更容易。

### Pointfree编程

函数组合


不使用可变的变量

## 函数式编程的代码表象

我们先来看一眼，函数式编程最大意义所在的pointfree编程风格的代码：

```
const func123 = func1(func2(func3()));
const func45 = func4(func5());
const func14 = func1(func4());
const func235 = func2(func3(func5()));

func123(a);
func45(b);
```

而命令式编程一般这么写，明显就不够看了：

```
const func123 = (a, b) => {
    const [c,d] = func1(a, b);
    const [e,f,g] = func2(c, d);
    const h = func3(c, e, f);
    return [g, h];
}
```

因此，从代码表象上看，函数式编程就是一系列嵌套的函数调用，通过尽可能抽象出更多的公共函数，以及最小化每个函数的功能，使得我们可以像搭积木一样方便的通过组合来实现各种各样的上层应用。

接下来，我们来看一段比较术语化的函数式编程的描述。



## 什么是函数式编程

编程范式函数式编程是一种编程范式，我们常见的编程范式有命令式编程（Imperative programming），函数式编程，常见的面向对象编程是也是一种命令式编程。

命令式编程是面向计算机硬件的抽象，有变量（对应着存储单元），赋值语句（获取，存储指令），表达式（内存引用和算术运算）和控制语句（跳转指令），一句话，命令式程序就是一个冯诺依曼机的指令序列。

而函数式编程是面向数学的抽象，将计算描述为一种表达式求值，一句话，函数式程序就是一个表达式。函数式编程的本质函数式编程中的函数这个术语不是指计算机中的函数（实际上是Subroutine），而是指数学中的函数，即自变量的映射。也就是说一个函数的值仅决定于函数参数的值，不依赖其他状态。比如sqrt(x)函数计算x的平方根，只要x不变，不论什么时候调用，调用几次，值都是不变的。

从理论上说，函数式语言也不是通过冯诺伊曼体系结构的机器上运行的，而是通过λ演算来运行的，就是通过变量替换的方式进行，变量替换为其值或表达式，函数也替换为其表达式，并根据运算符进行计算。λ演算是图灵完全（Turing completeness）的，但是大多数情况，函数式程序还是被编译成（冯诺依曼机的）机器语言的指令执行的。

比起命令式编程，函数式编程更加强调程序执行的结果而非执行的过程，倡导利用若干简单的执行单元让计算结果不断渐进，逐层推导复杂的运算，而不是设计一个复杂的执行过程。

总的来说，函数式编程关心数据的映射，采用声明式的表达式来编程；命令式编程关心解决问题的步骤，采用具体的代码指令来编程。

### 一等公民的函数

在很多传统语言（C/C++/Java/C#等）中，函数都是作为一个二等公民存在，你只能用语言的关键字声明一个函数然后调用它，如果需要把函数作为参数传给另一个函数，或是赋值给一个本地变量，又或是作为返回值，就需要通过函数指针(function pointer)、代理(delegate)等特殊的方式周折一番。
而在JavaScript世界中函数却是一等公民，它不仅拥有一切传统函数的使用方式（声明和调用），而且可以做到像简单值一样赋值、传参、返回，这样的函数也称之为第一级函数（First-class Function）。不仅如此，JavaScript中的函数还充当了类的构造函数的作用，同时又是一个Function类的实例(instance)。这样的多重身份让JavaScript的函数变得非常重要。

如果函数作为参数或返回值使用时，就称为高阶函数，

匿名函数 嵌套函数 类构造函数 闭包

#### 纯函数




## 如何实现函数式编程

为了实现函数式编程这种大规模的嵌套函数调用模式，首先，我们需要先理解函数式编程的特点和要求。

### 柯里化（Curry）

### 惰性求值

### Pipeline


### 从语句到表达式

#### 算术运算

现在有这样一个数学表达式：
```
(1 + 2) * 3 - 4
```
传统的命令式编程，可能这样写：
```
let a = 1 + 2
let b = a * 3
let c = b - 4
```
函数式编程要求使用函数，我们可以把运算过程定义为不同的函数（使用Ramdajs），然后写成下面这样：

let result = R.subtract(R.multiply(R.add(1, 2), 3), 4)


#### 逻辑运算

#### 条件语句分支

#### 异步操作

#### 递归调用


### 函数式编程的优点


1. 代码精简，开发效率高（实际上需要开发者深入理解Functor|Monada等基础概念、以及相关库的使用方法，否则可能很难看懂代码）
2. 接近自然语言，易于理解（原因同上，还有另一个非常重要的原因，由于每个开发者对于业务的理解和抽象水平的差异，以及命名能力的差异，导致很多函数名以及变量并不能够准确反映其实际意义，代码是否易于理解，这方面的影响可能反而是最大的，这和函数式编程无关，属于编程的常见问题；另外，如何函数的组织逻辑，也在很大程度上影响了可读性）
3. 易于测试
4. 易于实现并行编程


### 工程问题

代码易读性其实并不好，新概念太多，学习起来比较费劲。




### 延伸阅读~范畴学~Haskell

Fantasy-Land和Functors|Monads














